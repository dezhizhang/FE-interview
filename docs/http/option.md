# POST 请求多发送一次 OPTIONS 请求的原因

在 Web 开发中，浏览器的安全机制会对跨域请求进行一些限制，以保护用户数据安全。特别是在使用 POST 请求时，如果涉及跨域请求，浏览器可能会发送一个 OPTIONS 请求，称为“预检请求”（Preflight Request）。以下是该行为的详细解释。

---

#### 1. 跨域请求的背景

- **跨域请求**：当一个网页试图请求一个不同源（域名、协议或端口）的资源时，这称为跨域请求。由于安全原因，浏览器会对这些请求施加限制。
- **同源策略**：这是浏览器的安全机制，限制从一个源加载的文档或脚本与来自不同源的资源进行交互。

---

#### 2. 预检请求的定义

- **OPTIONS 请求**：在发起实际的 POST 请求之前，浏览器会首先发送一个 OPTIONS 请求到目标服务器，询问该服务器是否允许该种请求及其相关的请求头。
- **预检请求**：这一步骤被称为预检请求，主要用于确保服务器支持实际的跨域请求。

---

#### 3. 何时发送预检请求

预检请求通常在以下情况下触发：

- **自定义请求头**：如果请求中包含自定义的头部信息（如 `Authorization`、`X-Custom-Header` 等）。
- **非简单请求方法**：如果请求方法不是 GET、POST 或 HEAD，例如使用 PUT、DELETE 等方法。
- **非简单请求的内容类型**：如果请求的 `Content-Type` 不是 `application/x-www-form-urlencoded`、`multipart/form-data` 或 `text/plain`。

---

#### 4. 预检请求的流程

1. **浏览器发送 OPTIONS 请求**：
 - 该请求包含请求方法、请求头以及请求源的信息。
   
2. **服务器响应**：
 - 如果服务器允许该请求，响应中会包含 `Access-Control-Allow-Origin`、`Access-Control-Allow-Methods` 和 `Access-Control-Allow-Headers` 等 CORS 相关的头信息。
   
3. **浏览器发送实际请求**：
 - 如果预检请求得到了允许的响应，浏览器才会继续发送实际的 POST 请求。

---

#### 5. 总结

预检请求的目的是确保跨域请求的安全性，避免潜在的安全风险。虽然这会增加一次额外的请求，但它能够有效防止恶意行为，保护用户数据的安全性。

| 请求类型       | 描述                                     |
|----------------|------------------------------------------|
| OPTIONS 请求   | 询问服务器是否支持跨域请求及其配置    |
| POST 请求      | 实际发送数据到服务器的请求              |

了解预检请求的机制有助于开发者更好地处理跨域请求并避免因安全策略造成的问题。
