# WebGL 中的深度测试和混合

在 WebGL 中，深度测试（Depth Testing）和混合（Blending）是两种重要的图形渲染技术，它们影响渲染结果中物体的可见性和透明度。理解这两种技术对于渲染复杂的 3D 场景非常重要。

## 1. **深度测试（Depth Testing）**

### 1.1 **深度测试的作用**

深度测试用于确定一个片元（像素）是否被其他物体遮挡。它基于每个片元的深度值来决定是否将该片元绘制到屏幕上。深度值是指片元到摄像机的距离，深度测试确保了场景中的物体按照正确的层次顺序渲染，从而避免物体的重叠或视觉错误。

### 1.2 **深度缓冲区（Depth Buffer）**

深度缓冲区是一个存储每个像素深度值的缓冲区，它在绘制每个像素时记录该像素的深度。WebGL 在渲染过程中会使用这个缓冲区进行深度比较，判断该片元是否应该覆盖当前像素。

### 1.3 **启用深度测试**

要启用深度测试，在 WebGL 中使用 `gl.enable(gl.DEPTH_TEST)`。这会告诉 WebGL 使用深度缓冲区，并根据当前深度测试的设置进行比较。

```javascript
// 启用深度测试
gl.enable(gl.DEPTH_TEST);
```

## 1.4 深度测试的工作原理
深度测试会基于片元深度值与深度缓冲区中存储的值进行比较。WebGL 提供了多种深度比较方式，通过 gl.depthFunc() 方法设置。常见的深度函数包括：

- gl.LESS（默认）：当当前片元的深度小于存储在深度缓冲区中的值时，该片元会被渲染。
- gl.LEQUAL：当当前片元的深度小于或等于存储在深度缓冲区中的值时，该片元会被渲染。
- gl.GREATER：当当前片元的深度大于存储在深度缓冲区中的值时，该片元会被渲染。
- gl.GEQUAL：当当前片元的深度大于或等于存储在深度缓冲区中的值时，该片元会被渲染。
- gl.EQUAL：当当前片元的深度等于存储在深度缓冲区中的值时，该片元会被渲染。
例如：

```javascript

// 设置深度测试为片元深度小于缓冲区中的深度
gl.depthFunc(gl.LESS);
```